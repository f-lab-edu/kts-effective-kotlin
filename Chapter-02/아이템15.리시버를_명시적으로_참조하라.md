# ì•„ì´í…œ15. ë¦¬ì‹œë²„ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì°¸ì¡°í•˜ë¼

ì½”í‹€ë¦°ì—ì„œëŠ” `íŠ¹ì • ê°ì²´(íƒ€ì…)`ì„ ë¦¬ì‹œë²„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```kotlin
// block: (T) -> R  ì¼ë°˜ì ì¸ í•¨ìˆ˜ ì •ì˜
val block: (Int) -> Int = ...
block(3)

// block: T.() -> R  ê°ì²´ Të¥¼ receiver ë¡œ í™œìš©í•œë‹¤.
val block: Int.() -> Int = ...
100.block(3)
```

ì´ ê²½ìš°ì—ëŠ” `this`ë¥¼ ì‚¬ìš©í•´ì„œ ë¦¬ì‹œë²„ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.
```kotlin
val sum = fun Int.(other: Int): Int {
    return this + other // í‚¤ì›Œë“œ this ë¥¼ ì´ìš©í•´ ë¦¬ì‹œë²„ ê°ì²´ì— ì ‘ê·¼í•œë‹¤.
}

val result = 3.sum(5)
print(result) // 8
```

<br>

ì½”í‹€ë¦°ì˜ `with` í•¨ìˆ˜ë„ ì´ëŸ¬í•œ ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤.  
`ë¦¬ì‹œë²„ ê°ì²´`ì™€ `ì¶”ê°€í•  í•¨ìˆ˜`ë¥¼ ì¸ìë¡œ ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
```kotlin
// with( T,  T.() -> R) )
// with(T) { T.() -> R }
inline fun <T, R> with(receiver: T, block: T.() -> R): R {
    ...
    
    // ì…ë ¥ë°›ì€ Të¥¼ ë¦¬ì‹œë²„ë¡œ, ì…ë ¥ë°›ì€ í•¨ìˆ˜ block ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.
    return receiver.block()
}
```
ë§ˆì°¬ê°€ì§€ë¡œ `this` ë¦¬ì‹œë²„ë¥¼ í™œìš©í•´ì„œ ì°¸ì¡°ê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.   
```kotlin
val myString = StringBuilder()
with(myString) {
    this.append("ì•ŒíŒŒë²³: ")
    for (ch in 'a'..'e') {
        this.append(ch) // T.append(..)
    }
    this.toString() // T.toString(..)
}

print(myString) // "ì•ŒíŒŒë²³: abcde"
```

<br>

ì½”í‹€ë¦°ì—ì„œ `this`ë¥¼ ìƒëµí•  ìˆ˜ ìˆë‹¤. ì¦‰ ì•„ì˜ˆ ë¦¬ì‹œë²„ ì—†ì´ í•¨ìˆ˜ë§Œ ì ì–´ ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
```kotlin
val sb = StringBuilder()
with(sb) { 
    appendln("ì•ŒíŒŒë²³:")
    for (ch in 'a'..'z'){
        append(ch)
    }
    toString()
}
```

<br>

## ğŸ“ ì—¬ëŸ¬ ê°œì˜ ë¦¬ì‹œë²„
thisë¥¼ ìƒëµí•´ì„œ ì‚¬ìš©í•˜ë©´, ì½”ë“œê°€ ê°„ê²°í•´ì ¸ ì½ê¸° ì¢‹ì•„ì§„ë‹¤.  
í•˜ì§€ë§Œ ì•„ë˜ì™€ ê°™ì´ ë¦¬ì‹œë²„ê°€ ì—¬ëŸ¬ ê°œì¼ ë•Œì—ëŠ” ìƒëµí•˜ì§€ ë§ê³  `this`ê°™ì€ ë¦¬ì‹œë²„ë¥¼ ëª…ì‹œí•´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.

```kotlin
class Node(val name: String){
    
    fun makeChild(child: String) {
        // í´ë˜ìŠ¤ì˜ this.name ì¼ê¹Œ? ìƒˆë¡œ ìƒì„±í•œ ìì‹ Node.name ì¼ê¹Œ?
        create("$name.$child")
            .apply { print("Created ${name}") }
    }

    fun create(name: String) = Node(name)
}

fun main() {
    val node = Node("parent")
    node.makeChild("child") // "Created Parent"
}
```
`.apply`ì—ì„œ `this.name`ì´ ìƒˆë¡œ ìƒì„±í•œ Node ì´ê¸°ë¥¼ ë°”ë¬ì§€ë§Œ, ê·¸ë ‡ê²Œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.
ì´ëŸ´ ë•Œì—ëŠ” ì˜ë¯¸ê°€ ëª…í™•í•´ì§€ë„ë¡ ë¦¬ì‹œë²„`this`ë¥¼ ëª…í™•í•˜ê²Œ ì ì–´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.  
###
ì‚¬ì‹¤ ê°€ì¥ ì¢‹ì€ ì„ íƒì§€ëŠ” `.also` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.  
ì´ ê²½ìš° ëŒë‹¤í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê¸°ë•Œë¬¸ì—, ë¦¬ì‹œë²„ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ê²Œ ëœë‹¤.
```kotlin
class Node(val name: String){

    fun makeChild(child: String) {
        create("$name.$child")
            .also { print("Created ${it.name}") }
        //                "Created ${ name -> name }"
    }

    fun create(name: String) = Node(name)
}
```

##ğŸ“ DslMarker ì–´ë…¸í…Œì´ì…˜
ë‹¤ë§Œ DSL ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
DSLì€ ì•„ë˜ì™€ ê°™ì´ ë¦¬ì‹œë²„ë¥¼ ìƒëµí•´ì„œ ì‚¬ìš©í•˜ëŠ”ê±¸ ì „ì œë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.
```kotlin
table {
    tr{
        td{ + "Column1"}
        td{ + "Column2"}
    }
    tr{
        td{ + "Value1"}
        td{ + "Value2"}
    }
}
```
ì˜ˆë¥¼ ë“¤ì–´ ê°™ì€ ì´ë¦„ì„ ê°€ì§„ `tr`ì´ë¼ëŠ” í•¨ìˆ˜ê°€ ì™¸ë¶€ ìŠ¤ì½”í”„ì— ìˆë‹¤ë©´, `this`ê°€ ìƒëµëœ ë‚´ ì½”ë“œê°€ ì–´ë–¤ `tr`ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œê¸° ì–´ë ¤ìš¸ ê²ƒì´ë‹¤.

ê·¸ë˜ì„œ ì½”í‹€ë¦°ì—ì„œëŠ” `DslMarker` ì–´ë…¸í…Œì´ì…˜ì„ ì œê³µí•œë‹¤.
```kotlin
@DslMarker
annotation class HtmlDsl
```
```kotlin
@HtmlDsl
class TableDsl { /*...*/ }

fun table(f: TableDsl.() -> Unit) { /*...*/ }
```


ì´ë¥¼ ì‚¬ìš©í•˜ë©´, `ì•”ë¬µì ìœ¼ë¡œ ì™¸ë¶€ìŠ¤ì½”í”„ì˜ ë¦¬ì‹œë²„ë¥¼ í˜¸ì¶œ`í•˜ê²Œë˜ë©´ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.  

ë§Œì•½ ì™¸ë¶€ìŠ¤ì½”í”„ì— ìˆëŠ” ë™ì¼í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```kotlin
table {
    tr{
        td{ + "Column1"}
        td{ + "Column2"}
    }
    this@table.tr{
        td{ + "Value1"}
        td{ + "Value2"}
    }
}
```

<br>

ğŸ“Œ ì°¸ê³ ë¡œ ëŒë‹¤í•¨ìˆ˜ì— `return` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œì—ë„ ë¹„ìŠ·í•˜ê²Œ ì“¸ ìˆ˜ ìˆë‹¤.
<details markdown="1">
<summary> ë”ë³´ê¸° </summary>

* ê¸°ë³¸ì ìœ¼ë¡œ `return` ì€ ëŒë‹¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ì‚¬ìš©í•˜ë©´ `fun í•¨ìˆ˜`ì˜ ë°˜í™˜ê°’ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.
```kotlin
fun myFunc(){
    return list.flatMap{
        // ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ fun myFuncê°€ return listOf() ë˜ë²„ë¦°ë‹¤.
        if (it == 0) return listOf()
        listOf(it, it) // return ì´ ì‹¤í–‰ë˜ë©´ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ì–´ ë¬´ì‹œë˜ëŠ” ì½”ë“œ 
    }
}
```
- ì´ëŸ´ë• `return@name`ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```kotlin
list.flatMap {
    if (it == 0) return@flatMap listOf<Int>()
    listOf(it, it)
}

list.flatMap my@{ // í˜¹ì€ ì´ë ‡ê²Œ ë³„ëª…ì„ ë‹¬ì•„ì¤˜ë„ ëœë‹¤.
    if (it == 0) return@my listOf<Int>()
    listOf(it, it)
}
```

</details>
