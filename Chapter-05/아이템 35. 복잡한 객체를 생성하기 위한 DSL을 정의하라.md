# ì•„ì´í…œ 35. ë³µì¡í•œ ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ DSLì„ ì •ì˜í•˜ë¼.

`ì•„ì´í…œ 34` ì—ì„œ ì•„ë˜ì™€ ê°™ì€ êµ¬ì ˆì´ ìˆì—ˆìŠµë‹ˆë‹¤.

> ì´ëŸ¬í•œ ì½”ë“œëŠ” ì½”í‹€ë¦°ì—ì„œ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ì½”í‹€ë¦° ë¬¸ë²•ì„ ì´ìš©í•œ DSL(Domain Specific Language)ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
```kotlin
var dialog = context.alert(R.string.fire_missiles) {
    fireButton(R.string.fire) { /*..*/ }
    cancleButton { /*..*/ }
}

val route = router {
    "/home" directTo :: showHome
    "/users" directTo :: showUsers
}
```

<br>

## ğŸ“Œ DSL? ê·¸ê±° ì•„ë¬´ë„ ì•ˆì“°ëŠ” ê¸°ëŠ¥ ì•„ë‹Œê°€ìš”

ì•„ë‹ˆìš”. ì½”í‹€ë¦°ì—ì„œëŠ” ë‹¤ì–‘í•œ ê³³ì—ì„œ DSL ì„ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
`íŠ¹ë³„í•œ ë„êµ¬ê°€ í•„ìš”ì—†ìŠµë‹ˆë‹¤, ëª¨ë“  ê²Œ ì½”í‹€ë¦° ë¬¸ë²•ìœ¼ë¡œ ë§Œë“  DSLì…ë‹ˆë‹¤.`
- **HTML DSL**
```kotlin
body {
    div{
        a("https://kotlinlang.org"){
            target = ATarget.blank + "Main site"
        }
    }
    +"some content"
}
```

- **Andriod View DSL** (Anko ë¼ì´ë¸ŒëŸ¬ë¦¬)
```kotlin
verticalLayout{
    val name = editText()
    button("Say Hello"){
        onClick { toast("Hello, ${name.text}!")} // toast popup view
    }
}
```
- **Test DSL**
```kotlin
class MyTests: StringSpec({
    "ë°˜í™˜ë˜ëŠ” ê¸¸ì´ëŠ” Stringì˜ í¬ê¸°ì´ì–´ì•¼ í•©ë‹ˆë‹¤." {
        "test string".length shouldBe 5
    }
    "startsWith í•¨ìˆ˜ëŠ” prefixë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤."{
        "world" should startWith("wor")
    }
})
```
- **Gralde DSL**
```kotlin
plugins {
    'java-library'
}

dependencies{
    api("junit:junit:4.12")
    implementation("junit:junit:4.12")
    testImplementation("junit:junit:4.12")
}

configurations{
    implementation{
        resolutionStrategy.failOnVersionConflict()
    }
}
```

ì½”í‹€ë¦° DSLì€ íƒ€ì…ì— ì•ˆì „í•˜ë¯€ë¡œ `type-safe` ì»´íŒŒì¼ íƒ€ì„ì´ë‚˜ IDEì—ì„œ ì—¬ëŸ¬ê°€ì§€ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì´ë¯¸ ëˆ„êµ°ê°€ ë§Œë“¤ì–´ë‘” DSLì„ ì‚¬ìš©í• í…Œì§€ë§Œ, í•„ìš”í•œ ê²½ìš° ì§ì ‘ ë§Œë“¤ì–´ë„ ë©ë‹ˆë‹¤.

<br>

## ğŸ“Œì‚¬ìš©ì ì •ì˜ DSL ë§Œë“¤ê¸°
ì‚¬ìš©ì ì •ì˜ DSLë¥¼ ë§Œë“œë ¤ë©´, ë¨¼ì € ë¦¬ì‹œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.   
ì½”í‹€ë¦°ì— ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´ ì´í•´í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìœ¼ë‹ˆ, í•˜ë‚˜ì”© ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë´…ì‹œë‹¤.
```kotlin
inline fun <T> Iterable<T>.filter(predicate: (T) -> Boolean): List<T> {
    val list = arrayListOf<T>()
    
    for (elem in this){
        if (predicate(elem)){ list.add(elem) }
    }
    return list
}
```

<br>

### 1. í•¨ìˆ˜ì˜ íƒ€ì…
ì½”í‹€ë¦°ì—ì„œëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê³ , ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì€ `í•¨ìˆ˜ íƒ€ì…`ì´ ì¡´ì¬í•©ë‹ˆë‹¤
- `()->Unit` : ì¸ìê°€ ì—†ê³ , Unitì„ ë¦¬í„´í•©ë‹ˆë‹¤. (ë°˜í™˜ê°’ ì—†ìŒ)
- `(Int)->Unit` : Int ì¸ìë¥¼ ë°›ê³ , Unitì„ ë¦¬í„´í•©ë‹ˆë‹¤. (ë°˜í™˜ê°’ ì—†ìŒ)
- `(Int)->Int` : Int ì¸ìë¥¼ ë°›ê³ , Intë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
- `(Int,Int)->Int` : Int, Int ì´ 2ê°œë¥¼ ë°›ê³ , Intë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤
- `(Int)->()->Unit` : Int ì¸ìë¥¼ ë°›ê³ , `()->Unit` íƒ€ì…ì¸ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
- `(()->Unit)->Unit` : `()->Unit` íƒ€ì…ì¸ í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê³ , Unitì„ ë¦¬í„´í•©ë‹ˆë‹¤. (ë°˜í™˜ê°’ ì—†ìŒ)

<br>

### 2. í•¨ìˆ˜ë¥¼ ë§Œë“œëŠ” ë²•
í•¨ìˆ˜ íƒ€ì…ì€ `ëŒë‹¤ í‘œí˜„ì‹` `ìµëª… í•¨ìˆ˜` `í•¨ìˆ˜ ë ˆí¼ëŸ°ìŠ¤`ë¥¼ ì´ìš©í•´ì„œ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```kotlin
fun plus(a: Int, b: Int) = a + b // í•¨ìˆ˜
```
```kotlin
// val name: type = ...
val plusLambda:    (Int, Int)->Int = {a,b -> a + b}
val plusAnonymous: (Int, Int)->Int = fun(a,b) = a + b
val plusReference: (Int, Int)->Int = ::plus
```

ë¬¼ë¡  íƒ€ì… ì •ë³´ëŠ” ì½”í‹€ë¦°ì˜ íƒ€ì…ì¶”ë¡ ì„ ì´ìš©í•´ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```kotlin
val plusLambda = {a: Int, b: Int -> a + b}
val plusAnonymous = fun(a: Int, b: Int) = a + b
```

<br>

### 3. í™•ì¥í•¨ìˆ˜ì˜ íƒ€ì… (ë¦¬ì‹œë²„ë¥¼ ê°€ì§„ í•¨ìˆ˜íƒ€ì…)
ì½”í‹€ë¦°ì—ëŠ” í™•ì¥í•¨ìˆ˜ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. í™•ì¥í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```kotlin
fun Int.myPlus(other: Int) = this + other // í™•ì¥í•¨ìˆ˜
```
```kotlin
val myPlus: Int.(Int)->Int = fun Int.(other: Int) = thie + other
val myPlus = fun Int.(other: Int) = thie + other // íƒ€ì… ìƒëµ
```

ì´ëŸ¬í•œ í™•ì¥í•¨ìˆ˜ì˜ íƒ€ì…ì„ `ë¦¬ì‹œë²„ë¥¼ ê°€ì§„ í•¨ìˆ˜ íƒ€ì…`ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
í™•ì¥í•¨ìˆ˜ì—ì„œ `ë¦¬ì‹œë²„`ëŠ” **this í‚¤ì›Œë“œ**ë¥¼ ì´ìš©í•´ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```kotlin
val myPlus: Int.(Int)->Int = { this + it } // { a -> this + a }
```

<br>

### 4. (ë¦¬ì‹œë²„ë¥¼ ê°€ì§„ í•¨ìˆ˜íƒ€ì…)ì„ í™œìš©í•˜ëŠ” ë°©ë²•
`ì˜ì–´ë¡œëŠ” Lambda with Receiver ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.`
```kotlin
inline fun <T> T.apply(block: T.() -> Unit): T {
    
    this.block() // ì¸ìë¡œ ë°›ì€ í™•ì¥í•¨ìˆ˜ë¥¼ ì ìš©ì‹œí‚µë‹ˆë‹¤.
    
    return this // ë¦¬ì‹œë²„ (ex User.apply() ë¼ë©´ User)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
}
```
```kotlin
// í™•ì¥í•¨ìˆ˜ë¥¼ Lambdaë¡œ êµ¬í˜„í•˜ì—¬ ì¸ìë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
val userLambda = User().apply({ this.name = "Marcin"; this.surname = "Jiwon"})

// ì½”í‹€ë¦°ì—ì„œëŠ” ë§ˆì§€ë§‰ ì¸ìê°€ í•¨ìˆ˜íƒ€ì…ì´ë©´, ì´ë ‡ê²Œ ë”°ë¡œ í‘œê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
val user = User().apply {
    this.name = "Marcin"
    this.surname = "jiwon"
}

// ë¦¬ì‹œë²„(this)ëŠ” ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
val user2 = User().apply {
    name = "Marcin"
    surname = "Jiwon"
}
```

<br>

### 5. DSL ë§Œë“¤ê¸°
ì˜ ë”°ë¼ ì˜¤ì…¨ìŠµë‹ˆë‹¤. ì‚´ì§ ê°ì´ ì˜¤ì‹œì£ ? ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ HTML DSLì„ ì§ì ‘ ë§Œë“¤ì–´ë´…ì‹œë‹¤.
```kotlin
fun createTable(): TableDsl = table { // table(...) -> TableBuilder í•¨ìˆ˜
    tr{ // TableBuilder.tr(...) í•¨ìˆ˜
        for(i in 1..2){
            td{ // TrBuilder.td(...) í•¨ìˆ˜
                +"This is column $i"
            }
        }
    }
}
```
ì´ëŠ” í†± ë ˆë²¨ì— table() í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³ , ì•„ë˜ì™€ ê°™ì€ í´ë˜ìŠ¤ êµ¬ì¡°ë¥¼ ê°€ì§€ê²Œ í•˜ë©´ ë©ë‹ˆë‹¤.
```kotlin
fun table(init: TableBuilder.()->Unit): TableBuilder { 
    val tableBuilder = TableBuilder()
    init.invoke(tableBuilder)
    
    return tableBuilder
}

class TableBuilder {
    var trs = listOf<TrBuilder>()
    fun tr(init: TrBuilder.()->Unit) { /*..*/ }
}

class TrBuilder {
    var tds = listOf<TdBuilder>()
    fun td(init: TdBuilder.()->Unit) { /*..*/ }
}

// + "This is Column" ëŠ” ì´ë ‡ê²Œ êµ¬í˜„í•˜ë©´ ë©ë‹ˆë‹¤.
class TdBuilder{
    var text = ""
    operator fun String.unaryPlus() {// "+" ì—°ì‚°ì ì˜¤ë²„ë¡œë”©
        text += this
    }
}
```

ê·¸ë¦¬ê³  ì›í•˜ëŠ” ë™ì‘ì„ êµ¬í˜„í•˜ë©´ ë©ë‹ˆë‹¤.  
ì²˜ìŒì´ë¼ ë§ì´ ìƒì†Œí•˜ê² ì§€ë§Œ, `í™•ì¥í•¨ìˆ˜ì™€ ë¦¬ì‹œë²„`ë¥¼ ì´í•´í•˜ê³  ìˆë‹¤ë©´ ê¸ˆë°© ì ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```kotlin
// apply í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´, ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
fun table(init: TableBuilder.()->Unit): TableBuilder = TableBuilder().apply(init)

class TableBuilder {
    var trs = listOf<TrBuilder>()

    fun td(init: TrBuilder.()->Unit){
        trs = trs + TrBuilder().apply(init)
    }
}


class TrBuilder {
    var tds = listOf<TdBuilder>()
    
    fun td(init: TdBuilder.()->Unit) {
        tds = tds + TdBuilder().apply(init)    
    }
}


class TdBuilder{
    var text = ""

    operator fun String.unaryPlus() {// "+" ì—°ì‚°ì ì˜¤ë²„ë¡œë”©
        text += this
    }
}
```

<br>

## ğŸ§¨ DSLì˜ ë‹¨ì 
DSLì„ êµ¬í˜„í•˜ë©´ ì‚¬ìš©ë²•ì´ ê°„ë‹¨í•´ì§€ê³ , ì½”ë“œ ê°€ë…ì„±ì´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.
í•˜ì§€ë§Œ `ê°œë°œì ì…ì¥`ì—ì„œ `ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€` íŒŒì•…í•˜ê¸°ëŠ” ë§¤ìš° ì–´ë µìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ë‹¨ìˆœí•œ ê¸°ëŠ¥ì— êµ³ì´ DSLì„ ì‚¬ìš©í•˜ëŠ”ê±´ `ë‹­ ì¡ëŠ” ë° ì†Œ ì¡ëŠ” ì¹¼ì„ ì“°ëŠ” ê²©` ì…ë‹ˆë‹¤.  
ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì— ì ì ˆí•˜ê²Œ í™œìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- ë³µì¡í•œ ìë£Œ êµ¬ì¡°
- ê³„ì¸µì ì¸ êµ¬ì¡°
- ê±°ëŒ€í•œ ëŸ‰ì˜ ë°ì´í„°

ì‚¬ì‹¤, ì¢‹ì€ DSLì„ ë§Œë“œëŠ” ì‘ì—…ì€ ìƒë‹¹íˆ ì–´ë µìŠµë‹ˆë‹¤. 

í•˜ì§€ë§Œ ì•ˆì‹¬í•˜ì„¸ìš”. ë‹¤ì–‘í•œ ê³³ì—ì„œ ì´ë¯¸ ë§Œë“¤ì–´ì§„ DSLì´ ì¡´ì¬í•˜ê³ , ì˜ ì •ì˜ëœ DSLì€ í”„ë¡œì íŠ¸ì— í° ë„ì›€ì„ ì£¼ëŠ”ê±´ ë³€ì¹˜ì•Šìœ¼ë‹ˆê¹Œìš”.
